
>[!tip] Created: [2024-04-30 Tue 12:14]

>[!question] Targets: 

>[!danger] Depends: 

browser needs to hold a cookie which is sent up each time a request is made.

Then we need to get their github status and permissions whenever they try to do something.

Loathe to pass this thru from the top level ?
But we could just bundle up the cookies into the pierce action.

So the pierce into the session needs to be aware of this ?

Store the cookies in the repo, so we don't actually use them ?

Pass the cookies thru with each pierce request ?

Ignore the cookies, and only bother with the pubkey of the machine.

Store the cookie data in the users home chain

Snip a machine when its session is revoked

We need a check flow, so the machine session, once unauthed, is immediately rejected.
It should recognize deauth, and start a new pure machine session.  The PID would have changed so it is not valid

Pierce reading should throw with unauthorized error.

Should technically be its own subdomain which is used for chains that are gateway enabled, and can receive inbound requests.  We can emulate this for now by placing under the path `/github/*`.

We would ideally have a single oauth endpoint for the network of nApps, and this login is a common good, so that anyone who publishes a nApp does not need to do any auth of their own.

So can we make a standalone nApp with separate hosting for this purpose ?

Flow goes:
- browser determines it is time to auth
- browser navigates to the signin url where we add the machine pubkey as a query parameter
- in the nApp for github, we write the pubkey and assosciate it with the session id that was generated
- then we redirect them to github
- github sends the browser back to the callback url
- we then assosciate the PAT with the machine key
- machine branch is moved to the user branch
- send back the new PID 
